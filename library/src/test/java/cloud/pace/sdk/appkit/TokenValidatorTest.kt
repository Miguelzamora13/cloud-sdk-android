package cloud.pace.sdk.appkit

import android.os.Build
import cloud.pace.sdk.appkit.utils.TokenValidator
import org.junit.Test
import org.junit.runner.RunWith
import org.robolectric.RobolectricTestRunner
import org.robolectric.annotation.Config
import kotlin.test.assertEquals
import kotlin.test.assertFalse
import kotlin.test.assertTrue

@RunWith(RobolectricTestRunner::class)
@Config(sdk = [Build.VERSION_CODES.O_MR1])
class TokenValidatorTest {

    @Test
    fun `no payment method kinds allowed because of invalid token`() {
        val kinds = TokenValidator.paymentMethodKinds(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mYY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNl.m4rxXq74h1V9BhMAEi6O-LqcT-HRYa_mkbJmRCVCFqI"
        )
        assertEquals(null, kinds)
    }

    @Test
    fun `no payment method kinds allowed because of missing scopes`() {
        val kinds = TokenValidator.paymentMethodKinds(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNlcjp1c2VyLmVtYWlsOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpkZWxldGUgcGF5OnBheW1lbnQtbWV0aG9kczpyZWFkIGZ1ZWxpbmc6dHJhbnNhY3Rpb25zOmRlbGV0ZSB1c2VyOnRlcm1zOmFjY2VwdCB1c2VyOnVzZXIubG9jYWxlOnJlYWQiLCJzaWQiOiJjYjIwMzVmNC0wYzc2LTQ5NWMtOWNiMC1iYTYyYTE1NTVlYzEiLCJ6b25laW5mbyI6IkV1cm9wZS9CZXJsaW4iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibG9jYWxlIjoiZW4iLCJlbWFpbCI6ImhvcnN0QHBhY2UuY2FyIn0.N5h_GERtqMW_DQgGZQKoy-Fcfw7k1q2PfMBeTY4PfHc"
        )
        assertEquals(null, kinds)
    }

    @Test
    fun `multiple payment method kinds allowed`() {
        val kinds = TokenValidator.paymentMethodKinds(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNlcjp1c2VyLmVtYWlsOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpkZWxldGUgcGF5OnBheW1lbnQtbWV0aG9kczpyZWFkIGZ1ZWxpbmc6dHJhbnNhY3Rpb25zOmRlbGV0ZSB1c2VyOnRlcm1zOmFjY2VwdCB1c2VyOnVzZXIubG9jYWxlOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGU6ZGt2IHBheTpwYXltZW50LW1ldGhvZHM6Y3JlYXRlOmNyZWRpdGNhcmQgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGU6cGF5cGFsIHBheTpwYXltZW50LW1ldGhvZHM6Y3JlYXRlOnBheWRpcmVrdCIsInNpZCI6ImNiMjAzNWY0LTBjNzYtNDk1Yy05Y2IwLWJhNjJhMTU1NWVjMSIsInpvbmVpbmZvIjoiRXVyb3BlL0JlcmxpbiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJsb2NhbGUiOiJlbiIsImVtYWlsIjoiaG9yc3RAcGFjZS5jYXIifQ.WU-JW1ptJ4GipBDuIDeVxPyEGIcFuqjv56OvadNx7Q0"
        )
        assertEquals(listOf("dkv", "creditcard", "paypal", "paydirekt"), kinds)
    }

    @Test
    fun `one payment method kind allowed`() {
        val kinds = TokenValidator.paymentMethodKinds(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNlcjp1c2VyLmVtYWlsOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpkZWxldGUgcGF5OnBheW1lbnQtbWV0aG9kczpyZWFkIGZ1ZWxpbmc6dHJhbnNhY3Rpb25zOmRlbGV0ZSB1c2VyOnRlcm1zOmFjY2VwdCB1c2VyOnVzZXIubG9jYWxlOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGU6ZGt2Iiwic2lkIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiem9uZWluZm8iOiJFdXJvcGUvQmVybGluIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImxvY2FsZSI6ImVuIiwiZW1haWwiOiJob3JzdEBwYWNlLmNhciJ9.5Fmvx4wk0s8Ehu5Ts3ig2SfaZ2Uim6wKZVtID0OK0Vw"
        )
        assertEquals(listOf("dkv"), kinds)
    }

    @Test
    fun `all payment method kinds are allowed when generic and specific scopes are set`() {
        val kinds = TokenValidator.paymentMethodKinds(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNlcjp1c2VyLmVtYWlsOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpkZWxldGUgcGF5OnBheW1lbnQtbWV0aG9kczpyZWFkIGZ1ZWxpbmc6dHJhbnNhY3Rpb25zOmRlbGV0ZSB1c2VyOnRlcm1zOmFjY2VwdCB1c2VyOnVzZXIubG9jYWxlOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGU6ZGt2Iiwic2lkIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiem9uZWluZm8iOiJFdXJvcGUvQmVybGluIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImxvY2FsZSI6ImVuIiwiZW1haWwiOiJob3JzdEBwYWNlLmNhciJ9.TjF76khCQ5C30Nfa1GXyKxxBtnIn52g4WNYD71SGzwY"
        )
        assertEquals(emptyList(), kinds)
    }

    @Test
    fun `scopes are read out correctly`() {
        val scopes =
            TokenValidator.scopes("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTpwYXltZW50LW1ldGhvZHM6Y3JlYXRlIHVzZXI6cHJlZmVyZW5jZXM6cmVhZDpwYXltZW50LWFwcCIsInNpZCI6ImNiMjAzNWY0LTBjNzYtNDk1Yy05Y2IwLWJhNjJhMTU1NWVjMSIsInpvbmVpbmZvIjoiRXVyb3BlL0JlcmxpbiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJsb2NhbGUiOiJlbiIsImVtYWlsIjoiaG9yc3RAcGFjZS5jYXIifQ.K1jBvX9GBpDBMHXoP9LnxfmxnmV2bVsq7tuWa2KQyfg")
        assertEquals(listOf("openid", "poi:apps:read", "fueling:transactions:create", "pay:payment-methods:create", "user:preferences:read:payment-app"), scopes)
    }

    @Test
    fun `token is not expired`() {
        val isValid = TokenValidator.isTokenValid(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjQwNzA5MDg4MDAsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNlcjp1c2VyLmVtYWlsOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpkZWxldGUgcGF5OnBheW1lbnQtbWV0aG9kczpyZWFkIGZ1ZWxpbmc6dHJhbnNhY3Rpb25zOmRlbGV0ZSB1c2VyOnRlcm1zOmFjY2VwdCB1c2VyOnVzZXIubG9jYWxlOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGU6ZGt2Iiwic2lkIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiem9uZWluZm8iOiJFdXJvcGUvQmVybGluIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImxvY2FsZSI6ImVuIiwiZW1haWwiOiJob3JzdEBwYWNlLmNhciJ9.cF9ikMNV5ADxqSe_Lk5UlM_fGtIGoTp1N7UXrS5ebmM"
        )
        assertTrue(isValid)
    }

    @Test
    fun `token is expired`() {
        val isValid = TokenValidator.isTokenValid(
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDMyMTU3NjQsImlhdCI6MTY0MzIxNTcwNCwiYXV0aF90aW1lIjoxNjQzMjA2MzgyLCJqdGkiOiIwMTg0YTM4Yy02YzdkLTRiMDEtYjhiYi1mY2ZlYjAyM2M5NjYiLCJpc3MiOiJodHRwczovL2lkLmRldi5wYWNlLmNsb3VkL2F1dGgvcmVhbG1zL3BhY2UiLCJzdWIiOiI3M2VlYWUyZC1mMTE4LTRkZjMtOTFkZS1jZDAwZDM4OGQwNDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjbG91ZC1zZGstZXhhbXBsZS1hcHAiLCJub25jZSI6Ii1Rc3g4UHZxUHV6eFpTeDh3bkJKNHciLCJzZXNzaW9uX3N0YXRlIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiYWNyIjoiMCIsInNjb3BlIjoib3BlbmlkIHBvaTphcHBzOnJlYWQgZnVlbGluZzp0cmFuc2FjdGlvbnM6Y3JlYXRlIHBheTphcHBsZXBheS1zZXNzaW9uczpjcmVhdGUgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGUgdXNlcjpwcmVmZXJlbmNlczpyZWFkOnBheW1lbnQtYXBwIGZ1ZWxpbmc6ZGlzY291bnRzOmlucXVpcnkgcGF5OnBheW1lbnQtbWV0aG9kczpwYXRjaCB1c2VyOmRldmljZS10b3RwczpjcmVhdGUgdXNlcjp1c2Vycy5waW46Y2hlY2sgcGF5OnRyYW5zYWN0aW9uczpyZWFkIGZ1ZWxpbmc6Z2FzLXN0YXRpb25zOmFwcHJvYWNoaW5nIHBheTpwYXltZW50LXRva2VuczpkZWxldGUgcG9pOmdhcy1zdGF0aW9uczpyZWFkIHVzZXI6cHJlZmVyZW5jZXM6cmVhZCBmdWVsaW5nOnB1bXBzOnJlYWQgdXNlcjpvdHA6dmVyaWZ5IHVzZXI6b3RwOmNyZWF0ZSB1c2VyOnByZWZlcmVuY2VzOndyaXRlIHBheTpwYXltZW50LXRva2VuczpjcmVhdGUgcGF5OnRyYW5zYWN0aW9uczpyZWNlaXB0IHVzZXI6dXNlcnMucGluOnVwZGF0ZSB1c2VyY3JlZGl0OnVzZXIuY3JlZGl0OnJlYWQgdXNlcjpkZXZpY2UtdG90cHM6Y3JlYXRlLWFmdGVyLWxvZ2luIHVzZXI6dXNlcnMucGFzc3dvcmQ6Y2hlY2sgdXNlcjp1c2VyLmVtYWlsOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpkZWxldGUgcGF5OnBheW1lbnQtbWV0aG9kczpyZWFkIGZ1ZWxpbmc6dHJhbnNhY3Rpb25zOmRlbGV0ZSB1c2VyOnRlcm1zOmFjY2VwdCB1c2VyOnVzZXIubG9jYWxlOnJlYWQgcGF5OnBheW1lbnQtbWV0aG9kczpjcmVhdGU6ZGt2Iiwic2lkIjoiY2IyMDM1ZjQtMGM3Ni00OTVjLTljYjAtYmE2MmExNTU1ZWMxIiwiem9uZWluZm8iOiJFdXJvcGUvQmVybGluIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImxvY2FsZSI6ImVuIiwiZW1haWwiOiJob3JzdEBwYWNlLmNhciJ9.TjF76khCQ5C30Nfa1GXyKxxBtnIn52g4WNYD71SGzwY"
        )
        assertFalse(isValid)
    }
}
